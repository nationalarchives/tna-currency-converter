var conversion_data = {
    "1270": {
        "inflation": 532.72,
        "horse_price": 0.76,
        "cow_price": 0.35,
        "wool_price": 0.13,
        "wheat_price": 0.16,
        "wage_price": 0.01,
        "century": "13th"
    },
    "1280": {
        "inflation": 506.62,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01,
        "century": "13th"
    },
    "1290": {
        "inflation": 536.83,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01,
        "century": "13th"
    },
    "1300": {
        "inflation": 517.54,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01,
        "century": "14th"
    },
    "1310": {
        "inflation": 446.49,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01,
        "century": "14th"
    },
    "1320": {
        "inflation": 335.83,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01,
        "century": "14th"
    },
    "1330": {
        "inflation": 447.68,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02,
        "century": "14th"
    },
    "1340": {
        "inflation": 546.73,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02,
        "century": "14th"
    },
    "1350": {
        "inflation": 428.64,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02,
        "century": "14th"
    },
    "1360": {
        "inflation": 363.44,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02,
        "century": "14th"
    },
    "1370": {
        "inflation": 358.01,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02,
        "century": "14th"
    },
    "1380": {
        "inflation": 450.48,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02,
        "century": "14th"
    },
    "1390": {
        "inflation": 483.3,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02,
        "century": "14th"
    },
    "1400": {
        "inflation": 447.28,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02,
        "century": "15th"
    },
    "1410": {
        "inflation": 459.93,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02,
        "century": "15th"
    },
    "1420": {
        "inflation": 469.35,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02,
        "century": "15th"
    },
    "1430": {
        "inflation": 455.77,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03,
        "century": "15th"
    },
    "1440": {
        "inflation": 469.35,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03,
        "century": "15th"
    },
    "1450": {
        "inflation": 455.77,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03,
        "century": "15th"
    },
    "1460": {
        "inflation": 469.35,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03,
        "century": "15th"
    },
    "1470": {
        "inflation": 500.58,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03,
        "century": "15th"
    },
    "1480": {
        "inflation": 504.59,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03,
        "century": "15th"
    },
    "1490": {
        "inflation": 488.93,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03,
        "century": "15th"
    },
    "1500": {
        "inflation": 486.1,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03,
        "century": "16th"
    },
    "1510": {
        "inflation": 483.77,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03,
        "century": "16th"
    },
    "1520": {
        "inflation": 379.58,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03,
        "century": "16th"
    },
    "1530": {
        "inflation": 322.1,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03,
        "century": "16th"
    },
    "1540": {
        "inflation": 307.56,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03,
        "century": "16th"
    },
    "1550": {
        "inflation": 200.51,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03,
        "century": "16th"
    },
    "1560": {
        "inflation": 170.3,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03,
        "century": "16th"
    },
    "1570": {
        "inflation": 173.89,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03,
        "century": "16th"
    },
    "1580": {
        "inflation": 149.31,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05,
        "century": "16th"
    },
    "1590": {
        "inflation": 125.29,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05,
        "century": "16th"
    },
    "1600": {
        "inflation": 100.64,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05,
        "century": "17th"
    },
    "1610": {
        "inflation": 97.88,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05,
        "century": "17th"
    },
    "1620": {
        "inflation": 96,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05,
        "century": "17th"
    },
    "1630": {
        "inflation": 89.16,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07,
        "century": "17th"
    },
    "1640": {
        "inflation": 85.8,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07,
        "century": "17th"
    },
    "1650": {
        "inflation": 75.56,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07,
        "century": "17th"
    },
    "1660": {
        "inflation": 76.77,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07,
        "century": "17th"
    },
    "1670": {
        "inflation": 83.05,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07,
        "century": "17th"
    },
    "1680": {
        "inflation": 83.54,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09,
        "century": "17th"
    },
    "1690": {
        "inflation": 87.47,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09,
        "century": "17th"
    },
    "1700": {
        "inflation": 78.09,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09,
        "century": "18th"
    },
    "1710": {
        "inflation": 76.59,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09,
        "century": "18th"
    },
    "1720": {
        "inflation": 84.75,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09,
        "century": "18th"
    },
    "1730": {
        "inflation": 85.98,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1,
        "century": "18th"
    },
    "1740": {
        "inflation": 86.29,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1,
        "century": "18th"
    },
    "1750": {
        "inflation": 85.16,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1,
        "century": "18th"
    },
    "1760": {
        "inflation": 74.79,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1,
        "century": "18th"
    },
    "1770": {
        "inflation": 63.69,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1,
        "century": "18th"
    },
    "1780": {
        "inflation": 62.85,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15,
        "century": "18th"
    },
    "1790": {
        "inflation": 56.03,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15,
        "century": "18th"
    },
    "1800": {
        "inflation": 32.17,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15,
        "century": "19th"
    },
    "1810": {
        "inflation": 33.96,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15,
        "century": "19th"
    },
    "1820": {
        "inflation": 41.92,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15,
        "century": "19th"
    },
    "1830": {
        "inflation": 49.49,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2,
        "century": "19th"
    },
    "1840": {
        "inflation": 44.1,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2,
        "century": "19th"
    },
    "1850": {
        "inflation": 58.53,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2,
        "century": "19th"
    },
    "1860": {
        "inflation": 43.16,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2,
        "century": "19th"
    },
    "1870": {
        "inflation": 45.7,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2,
        "century": "19th"
    },
    "1880": {
        "inflation": 48.31,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33,
        "century": "19th"
    },
    "1890": {
        "inflation": 59.89,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33,
        "century": "19th"
    },
    "1900": {
        "inflation": 57.06,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33,
        "century": "20th"
    },
    "1905": {
        "inflation": 57.35,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33,
        "century": "20th"
    },
    "1910": {
        "inflation": 57.06,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33,
        "century": "20th"
    },
    "1915": {
        "inflation": 43.06,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33,
        "century": "20th"
    },
    "1920": {
        "inflation": 21.21,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33,
        "century": "20th"
    },
    "1925": {
        "inflation": 29.97,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 0.33,
        "century": "20th"
    },
    "1930": {
        "inflation": 33.42,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 0.33,
        "century": "20th"
    },
    "1935": {
        "inflation": 36.98,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42,
        "century": "20th"
    },
    "1940": {
        "inflation": 28.72,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42,
        "century": "20th"
    },
    "1945": {
        "inflation": 25.95,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42,
        "century": "20th"
    },
    "1950": {
        "inflation": 22.78,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42,
        "century": "20th"
    },
    "1955": {
        "inflation": 17.42,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42,
        "century": "20th"
    },
    "1960": {
        "inflation": 15.3,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42,
        "century": "20th"
    },
    "1965": {
        "inflation": 12.86,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42,
        "century": "20th"
    },
    "1970": {
        "inflation": 10.28,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42,
        "century": "20th"
    },
    "1975": {
        "inflation": 5.57,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6,
        "century": "20th"
    },
    "1980": {
        "inflation": 2.85,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6,
        "century": "20th"
    },
    "1985": {
        "inflation": 2.01,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6,
        "century": "20th"
    },
    "1990": {
        "inflation": 1.51,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6,
        "century": "20th"
    },
    "1995": {
        "inflation": 1.28,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6,
        "century": "20th"
    },
    "2000": {
        "inflation": 1.12,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6,
        "century": "21st"
    },
    "2005": {
        "inflation": 1,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6,
        "century": "21st"
    },
    "2017": {
        "inflation": 1.37,
        "horse_price": 2387.37,
        "cow_price": 1200,
        "wool_price": 6.35,
        "wage_price": 100,
        "wheat_price": 1.88,
        "century": "21st"
    },
    "century_intros": {
        "13th": "Most peasants in the thirteenth century lived below a reasonable subsistence level and this standard declined during the century.",
        "14th": "Between 1315 and 1322, the Great Famine, brought about by unusually prolonged periods of heavy rainfall and cold spells, killed 10-15% of the population.",
        "15th": "A hierarchy of consumption patterns mirrored the social hierarchy. The poor bought locally and in small quantities, while the better-off ventured to small towns and provincial centres.",
        "16th": "The sixteenth century was a period of population rise and price inflation. The social pressure on those with wealth to display it was considerable.",
        "17th": "In the middle of the seventeenth century, the period of price and population rises ended and the country entered a period of stability in both, that was to last until the mid-eighteenth century.",
        "18th": "One of the immediate and most important effects of the Act of Union in 1707 was the creation of a united free trade area managed from London. ",
        "19th": "The period from the late 18th century to the mid-Victorian years witnessed a major shake up and change in both the economy and society.",
        "20th": "The twentieth century saw the most rapid and dramatic social and economic change of any century."
    }
};

$(function () {
    show_inputs_relevant_to_selected_year();

    $("#currency-form").submit(function (event) {
        event.preventDefault();

        if (check_validation()) {
            if (window.location.hash == '#currency-result') {
                window.location.hash = ''; // Reset so that browser will auto-scroll down again.
            }
            window.location.hash = '#currency-result';
            currency_output();
        }

    });

    $("#currency-year").change(function () {
        change_fieldset_text();
        show_inputs_relevant_to_selected_year();

    });
});

function show_inputs_relevant_to_selected_year() {
    if ( get_currency("#currency-year") > 1970) {
        /* Hide old UK currency inputs & show modern */

        $(".newer-currencies").each(function () {
            $(this).show();
            $(this).find("input").attr('required');

            var label_for_value = $(this).find("input").attr("name");
            $(this).find("label").attr('for',label_for_value);
        });

        $(".older-currencies").each(function () {
            $(this).hide();

            if($(this).find("input").length > 0) {
                $(this).find("input").removeAttr('required');
            }
            else {
                $(this).find("select").removeAttr('required');
            }

            $(this).find("label").removeAttr('for');
        });
    }
    else if ( get_currency("#currency-year") <= 1970) {
        /* Hide modern UK currency inputs & show old */

        $(".newer-currencies").each(function () {
            $(this).hide();
            $(this).find("input").removeAttr('required');
            $(this).find("label").removeAttr('for');
        });

        $(".older-currencies").each(function () {
            $(this).show();
            var label_for_value;

            if($(this).find("input").length > 0) {
                $(this).find("input").attr('required', true);
                label_for_value = $(this).find("input").attr("name");
                $(this).find("label").attr('for',label_for_value);
            }
            else {
                $(this).find("select").attr('required',true);
                label_for_value = $(this).find("select").attr("name");
                $(this).find("label").attr('for',label_for_value);
            }

        });
    }
}

function change_fieldset_text() {
    $('#currency-legend').text("Enter currency to show its purchasing power in " +  get_currency("#currency-year"));
    $('#currency-submit').val("Show purchasing power in " +  get_currency("#currency-year"));
}

function build_century_intro_paragraph(intro, century) {
    return "<div id='currency-century-intro'>" + "<p>" + intro + "</p>" +
        "<p id='currency-century-intro-read-more'><a href='./" + century + "-century.php'>Read more about the " + century + " century. </a></p></div>";
}

function currency_output() {
    var user_inputs = get_user_inputs();
    var currency_formula_return_values = currency_formula();

    var century_preview = "";
    var converted_money_string = number_to_pounds_string(currency_formula_return_values.money, true);

    if (user_inputs.century != "21st") {
        century_preview = build_century_intro_paragraph(conversion_data.century_intros[user_inputs.century], user_inputs.century);
    }
    var HTML_img_string = wp_child_theme.templateURL + "/img/";
    var HTML_output =

        "<div class='currency' id='currency-result'><h3 class='currency-result-header'>In 2017, this is worth approximately: </h3>" + "<span id='currency-large-text'>" + converted_money_string + "</span>" +

        "<h3 class='currency-result-header'>In " + user_inputs.year + ", you could buy one of the following with " + currency_formula_return_values.bp_string + ": </h3>" +

        build_currency_output_html("Horses", currency_formula_return_values.horses, "", HTML_img_string+"horse.png") +

        build_currency_output_html("Cows", currency_formula_return_values.cows, "", HTML_img_string+"cow.png") +

        build_currency_output_html("Wool", currency_formula_return_values.wool, "stones", HTML_img_string+"ewe.png") +

        build_currency_output_html("Wheat", currency_formula_return_values.wheat, "quarters", HTML_img_string+"wheat.png") +

        build_currency_output_html("Wages", currency_formula_return_values.wage, "days (skilled tradesman)", HTML_img_string+"coinage.png") +

        century_preview +
        "</div>";

    $("#currency-result").html(HTML_output);
    $("#currency-result").fadeIn();
}

function build_currency_output_html(string, value, unit, img) {
    return "<h4>" + " <img src='" + img + "'/>" + string + ": " + value + " " + unit + "</h4>";
}

function set_validation_message(message) {
    $("#currency-validation").text(message);
    $("#currency-validation").show();
}

function check_validation() {

    var year =  get_currency("#currency-year");
    var pounds =  get_currency("#currency-pounds");
    var shillings =  get_currency("#currency-shillings");
    var old_pence = get_currency("#currency-old-pence");
    var new_pence =  get_currency("#currency-new-pence");

    //Check if divisible by 10 - year must be 1270, 1280 and not 1271 or 1277 etc.
    if (year <= 1900) {

        if (year % 10 !== 0) {
            set_validation_message("Please enter a year ending in 0. For example 1270.");
            return false;
        }

    }

    //Check if divisible by 5 - year must be 1975 or 1980 and not 1971 or 1979 etc. (Unless it's 2017)
    else if (year > 1900) {

        if (year % 5 !== 0) {

            if (year !== 2017) {
                set_validation_message("Please enter a year ending in 5 or 0. For example 1975 or 1980.");
                return false;
            }

        }
    }


    if (year < 1270) {
        set_validation_message("Please enter a year above 1270.");
        return false;
    }

    if (pounds < 0) {
        set_validation_message("Please enter a positive whole number into the pounds field.");
        return false;
    }

    if (year <= 1970) {
        if (shillings < 0 || shillings > 19) {
            set_validation_message("Please enter a whole number between 0 and 19 into the shillings field. ");
            return false;
        }

        if (old_pence < 0 || old_pence > 11) {
            set_validation_message("Please enter a whole between 0 and 11 into the pence field.");
            return false;
        }

        if (pounds === 0 && old_pence === 0 && shillings === 0) {
            set_validation_message("Please enter a number above 0 into at least one field.");
            return false;
        }

    }

    if (year > 1970) {
        if (new_pence < 0 || new_pence > 99) {
            set_validation_message("Please enter a whole number between 0 and 99 into the pence field.");
            return false;
        }
        if (pounds === 0 && new_pence === 0) {
            set_validation_message("Please enter a number above 0 into at least one field.");
            return false;
        }

    }

    $("#currency-validation").hide();
    return true;
}


function old_money_to_new_formula(user_inputs) {
    var mathResult;

    user_inputs = user_inputs || get_user_inputs();

    if (user_inputs.year <= 1970) {

        mathResult = ((user_inputs.pounds + (user_inputs.shillings / 20) + (user_inputs.old_pence / 240) ) * user_inputs.inflation);

    }
    else if (user_inputs.year > 1970) {

        if (user_inputs.year !== 2017) {
            /*
            If the users input year isn't 2017, we need to add inflation to bring it up to 2005's value.
            Then in the second if statement, we add 2017's 37% inflation to bring the 2005 money value to 2017's value.
             */

            mathResult = (user_inputs.pounds + user_inputs.new_pence) * user_inputs.inflation;
        }
        else {
            mathResult = (user_inputs.pounds + user_inputs.new_pence);
        }

    }

    if (user_inputs.year !== 2017) {
        mathResult = mathResult * conversion_data[2017].inflation;
    }

    return mathResult.toFixed(2);
}

function currency_formula(user_inputs) {
    user_inputs = user_inputs || get_user_inputs();

    var currency_money_to_modern_value = old_money_to_new_formula(user_inputs);

    var buying_power_money_value;

    var bp_string = "";

    if (user_inputs.year < 1975) {
        buying_power_money_value = user_inputs.pounds + (user_inputs.shillings / 20) + (user_inputs.old_pence / 240);

        if (user_inputs.pounds > 0) {
            bp_string = number_to_pounds_string(user_inputs.pounds, false);
        }
        if (user_inputs.shillings > 0) {
            if (user_inputs.pounds > 0) {
                bp_string = bp_string + ", ";
            }

            bp_string = bp_string + user_inputs.shillings + "s";
        }
        if (user_inputs.old_pence > 0) {
            if (user_inputs.pounds > 0 || user_inputs.shillings > 0) {
                bp_string = bp_string + " & ";
            }
            bp_string = bp_string + user_inputs.old_pence + "d";
        }
    }
    else {
        buying_power_money_value = user_inputs.pounds + user_inputs.new_pence;

        bp_string = number_to_pounds_string(buying_power_money_value, true);
    }

    return {
        horses: Math.floor(buying_power_money_value / get_horse_price(user_inputs.year)),
        cows: Math.floor(buying_power_money_value / get_cow_price(user_inputs.year)),
        wool: Math.floor(buying_power_money_value / get_wool_price(user_inputs.year)),
        wheat: Math.floor(buying_power_money_value / get_wheat_price(user_inputs.year)),
        wage: Math.floor(buying_power_money_value / get_wage_price(user_inputs.year)),
        money: currency_money_to_modern_value,
        bp_string: bp_string
    };

}

function number_to_pounds_string(number, include_pence) {

    var split_number = number.toString().split(".");
    var pounds_string = split_number[0];
    var pence_string = split_number[1] || "";
    var split_number_pounds_length = pounds_string.length;

    var sliced_pounds_string = "";
    var output_string;

    // If the £ value is more than £999, we need to add a comma. E.g. 1000 needs to become £1,000.
    if (split_number_pounds_length > 3) {
        sliced_pounds_string = pounds_string.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
    }
    else {
        sliced_pounds_string = pounds_string;
    }

    if (pence_string.length === 1) {
        pence_string = pence_string + "0";
    }
    else if (pence_string.length === 0) {
        pence_string = "00";
    }

    if(include_pence){
        output_string = "£" + sliced_pounds_string + "." + pence_string;
    }
    else {
        output_string = "£" + sliced_pounds_string;
    }

    return output_string;
}

function get_inflation_rate(year) {
    return conversion_data[year].inflation;
}

function get_horse_price(year) {
    return conversion_data[year].horse_price;
}

function get_cow_price(year) {
    return conversion_data[year].cow_price;
}

function get_wool_price(year) {
    return conversion_data[year].wool_price;
}

function get_wheat_price(year) {
    return conversion_data[year].wheat_price;
}

function get_wage_price(year) {
    return conversion_data[year].wage_price;
}

function get_century(year) {
    if (year >= 2000) {
        return "21st";
    }
    else if (year >= 1900) {
        return "20th";
    }
    else if (year >= 1800) {
        return "19th";
    }
    else if (year >= 1700) {
        return "18th";
    }
    else if (year >= 1600) {
        return "17th";
    }
    else if (year >= 1500) {
        return "16th";
    }
    else if (year >= 1400) {
        return "15th";
    }
    else if (year >= 1300) {
        return "14th";
    }
    else if (year >= 1200) {
        return "13th";
    }
}


function get_currency(html_id) {

    if(html_id === "#currency-new-pence"){
        return parseInt($(html_id).val(), 10) / 100;
    }
    else {
        return parseInt($(html_id).val(), 10);
    }

}

function get_user_inputs() {

    // Returns users input, PLUS the inflation value based on the year they input.

    return {
        year: get_currency("#currency-year"),
        pounds: get_currency("#currency-pounds"),
        shillings: get_currency("#currency-shillings"),
        old_pence: get_currency("#currency-old-pence"),
        new_pence: get_currency("#currency-new-pence"),
        inflation: get_inflation_rate( get_currency("#currency-year")),
        century: get_century( get_currency("#currency-year"))
    };
}