var conversion_data = {
    "1270": {
        "inflation": 532.72,
        "horse_price": 0.76,
        "cow_price": 0.35,
        "wool_price": 0.13,
        "wheat_price": 0.16,
        "wage_price": 0.01
    },
    "1280": {
        "inflation": 506.62,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01
    },
    "1290": {
        "inflation": 536.83,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01
    },
    "1300": {
        "inflation": 517.54,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01
    },
    "1310": {
        "inflation": 446.49,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01
    },
    "1320": {
        "inflation": 335.83,
        "horse_price": 0.85,
        "cow_price": 0.45,
        "wool_price": 0.23,
        "wheat_price": 0.26,
        "wage_price": 0.01
    },
    "1330": {
        "inflation": 447.68,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02
    },
    "1340": {
        "inflation": 546.73,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02
    },
    "1350": {
        "inflation": 428.64,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02
    },
    "1360": {
        "inflation": 363.44,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02
    },
    "1370": {
        "inflation": 358.01,
        "horse_price": 0.69,
        "cow_price": 0.37,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.02
    },
    "1380": {
        "inflation": 450.48,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02
    },
    "1390": {
        "inflation": 483.3,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02
    },
    "1400": {
        "inflation": 447.28,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02
    },
    "1410": {
        "inflation": 459.93,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02
    },
    "1420": {
        "inflation": 469.35,
        "horse_price": 1.27,
        "cow_price": 0.58,
        "wool_price": 0.18,
        "wheat_price": 0.31,
        "wage_price": 0.02
    },
    "1430": {
        "inflation": 455.77,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03
    },
    "1440": {
        "inflation": 469.35,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03
    },
    "1450": {
        "inflation": 455.77,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03
    },
    "1460": {
        "inflation": 469.35,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03
    },
    "1470": {
        "inflation": 500.58,
        "horse_price": 0.76,
        "cow_price": 0.4,
        "wool_price": 0.14,
        "wheat_price": 0.37,
        "wage_price": 0.03
    },
    "1480": {
        "inflation": 504.59,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03
    },
    "1490": {
        "inflation": 488.93,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03
    },
    "1500": {
        "inflation": 486.1,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03
    },
    "1510": {
        "inflation": 483.77,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03
    },
    "1520": {
        "inflation": 379.58,
        "horse_price": 1.41,
        "cow_price": 0.38,
        "wool_price": 0.11,
        "wheat_price": 0.4,
        "wage_price": 0.03
    },
    "1530": {
        "inflation": 322.1,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03
    },
    "1540": {
        "inflation": 307.56,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03
    },
    "1550": {
        "inflation": 200.51,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03
    },
    "1560": {
        "inflation": 170.3,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03
    },
    "1570": {
        "inflation": 173.89,
        "horse_price": 4.75,
        "cow_price": 1.25,
        "wool_price": 0.32,
        "wheat_price": 0.93,
        "wage_price": 0.03
    },
    "1580": {
        "inflation": 149.31,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05
    },
    "1590": {
        "inflation": 125.29,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05
    },
    "1600": {
        "inflation": 100.64,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05
    },
    "1610": {
        "inflation": 97.88,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05
    },
    "1620": {
        "inflation": 96,
        "horse_price": 8.24,
        "cow_price": 1.86,
        "wool_price": 0.34,
        "wheat_price": 1.8,
        "wage_price": 0.05
    },
    "1630": {
        "inflation": 89.16,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07
    },
    "1640": {
        "inflation": 85.8,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07
    },
    "1650": {
        "inflation": 75.56,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07
    },
    "1660": {
        "inflation": 76.77,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07
    },
    "1670": {
        "inflation": 83.05,
        "horse_price": 6.37,
        "cow_price": 5.39,
        "wool_price": 0.8,
        "wheat_price": 3.83,
        "wage_price": 0.07
    },
    "1680": {
        "inflation": 83.54,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09
    },
    "1690": {
        "inflation": 87.47,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09
    },
    "1700": {
        "inflation": 78.09,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09
    },
    "1710": {
        "inflation": 76.59,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09
    },
    "1720": {
        "inflation": 84.75,
        "horse_price": 5.38,
        "cow_price": 4.16,
        "wool_price": 0.6,
        "wheat_price": 2,
        "wage_price": 0.09
    },
    "1730": {
        "inflation": 85.98,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1
    },
    "1740": {
        "inflation": 86.29,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1
    },
    "1750": {
        "inflation": 85.16,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1
    },
    "1760": {
        "inflation": 74.79,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1
    },
    "1770": {
        "inflation": 63.69,
        "horse_price": 6.85,
        "cow_price": 4.67,
        "wool_price": 0.47,
        "wheat_price": 1.63,
        "wage_price": 0.1
    },
    "1780": {
        "inflation": 62.85,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15
    },
    "1790": {
        "inflation": 56.03,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15
    },
    "1800": {
        "inflation": 32.17,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15
    },
    "1810": {
        "inflation": 33.96,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15
    },
    "1820": {
        "inflation": 41.92,
        "horse_price": 10.5,
        "cow_price": 5,
        "wool_price": 0.9,
        "wheat_price": 5.69,
        "wage_price": 0.15
    },
    "1830": {
        "inflation": 49.49,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2
    },
    "1840": {
        "inflation": 44.1,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2
    },
    "1850": {
        "inflation": 58.53,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2
    },
    "1860": {
        "inflation": 43.16,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2
    },
    "1870": {
        "inflation": 45.7,
        "horse_price": 15,
        "cow_price": 5.34,
        "wool_price": 0.66,
        "wheat_price": 2.01,
        "wage_price": 0.2
    },
    "1880": {
        "inflation": 48.31,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33
    },
    "1890": {
        "inflation": 59.89,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33
    },
    "1900": {
        "inflation": 57.06,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33
    },
    "1905": {
        "inflation": 57.35,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33
    },
    "1910": {
        "inflation": 57.06,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33
    },
    "1915": {
        "inflation": 43.06,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33
    },
    "1920": {
        "inflation": 21.21,
        "horse_price": 27.5,
        "cow_price": 9.69,
        "wool_price": 0.54,
        "wheat_price": 1.28,
        "wage_price": 0.33
    },
    "1925": {
        "inflation": 29.97,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 0.33
    },
    "1930": {
        "inflation": 33.42,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 0.33
    },
    "1935": {
        "inflation": 36.98,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42
    },
    "1940": {
        "inflation": 28.72,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42
    },
    "1945": {
        "inflation": 25.95,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42
    },
    "1950": {
        "inflation": 22.78,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42
    },
    "1955": {
        "inflation": 17.42,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42
    },
    "1960": {
        "inflation": 15.3,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42
    },
    "1965": {
        "inflation": 12.86,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42
    },
    "1970": {
        "inflation": 10.28,
        "horse_price": 255.2,
        "cow_price": 67.17,
        "wool_price": 4.44,
        "wheat_price": 5.98,
        "wage_price": 1.42
    },
    "1975": {
        "inflation": 5.57,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6
    },
    "1980": {
        "inflation": 2.85,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6
    },
    "1985": {
        "inflation": 2.01,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6
    },
    "1990": {
        "inflation": 1.51,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6
    },
    "1995": {
        "inflation": 1.28,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6
    },
    "2000": {
        "inflation": 1.12,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6
    },
    "2005": {
        "inflation": 1,
        "horse_price": 2387.37,
        "cow_price": 392.79,
        "wool_price": 5.36,
        "wheat_price": 17.36,
        "wage_price": 57.6
    },
    "2017": {
       "inflation": 1.37,
        "horse_price": 2387.37,
        "cow_price": 1200,
        "wool_price": 6.35,
        "wage_price": 100,
        "wheat_price": 1.88,
    }
};

$(function () {
    console.log("jQuery loaded.");
    hide_inputs_based_on_year(get_omtn_year(),"omtn");
    hide_inputs_based_on_year(get_bp_year(),"bp");
});

$("#omtn-year").change(function () {

   hide_inputs_based_on_year(get_omtn_year(),"omtn");

});

$("#bp-year").change(function () {

    hide_inputs_based_on_year(get_bp_year(),"bp");

});


function hide_inputs_based_on_year(year, id) {

    if(year > 1970){
        /* Hide old UK currency inputs & show modern */

        $("#" + id +"-shillings-row").hide();
        $("#" + id +"-old-pence-row").hide();
        $("#" + id +"-new-pence-row").show();
    }
    else if(get_omtn_year() <= 1970) {
        /* Hide modern UK currency inputs & show old */
        $("#" + id +"-shillings-row").show();
        $("#" + id +"-old-pence-row").show();
        $("#" + id +"-new-pence-row").hide();
    }

}

function omtn_output() {
    var omtn_result_float = omtn_formula(get_omtn_year(),get_omtn_pounds(),get_omtn_pounds(),get_omtn_old_pence(),get_omtn_new_pence(), get_inflation_rate(get_omtn_year()));
    var output_string =  omtn_result_float.toLocaleString('en-GB', {style: 'currency', currency: 'GBP'});

    $("#omtn-result").hide();
    $("#omtn-result").text("In 2005, this money is worth approximately " + output_string);
    $("#omtn-result").delay(500).fadeIn();
}

function bp_output() {

    var bp_values = bp_formula(get_bp_year(),get_bp_pounds(),get_bp_shillings(),get_bp_old_pence(),get_bp_new_pence(),get_inflation_rate(get_bp_year()));
    var HTML_output = "<ul>" +
        build_bp_li("Horses",bp_values.horses, "./img/horse.gif") +

        build_bp_li("Cows",bp_values.cows, "./img/cow.gif") +

        build_bp_li("Wool",bp_values.wool, "./img/wool.gif") +

        build_bp_li("Wheat",bp_values.wheat, "./img/wheat.gif") +

        build_bp_li("Wages",bp_values.wage, "./img/wages.gif") +
        "</ul>";

    $("#bp-result").hide();
    $("#bp-result").html(HTML_output);
    $("#bp-result").delay(500).fadeIn();
}

function build_bp_li(string,value, img) {
    return "<li>" + string + ": " + value + " <img src='"+ img +"'/>" +"</li>" ;
}

$("#omtn-form").submit(function (event) {
    event.preventDefault(); // Prevent PHP fallback
   
    omtn_output();
});

$("#bp-form").submit(function (event) {
    event.preventDefault(); // Prevent PHP fallback
   
    bp_output();
});

function get_omtn_year() {
    return parseInt($("#omtn-year").val());
}

function get_omtn_pounds() {
    return parseInt($("#omtn-pounds").val());
}

function get_omtn_shillings() {
    return parseInt($("#omtn-shillings").val());
}

function get_omtn_old_pence() {
    return parseInt($("#omtn-old-pence").val());
}

function get_omtn_new_pence() {
    return parseInt($("#omtn-new-pence").val())/100;
}


function get_bp_year() {
    return parseInt($("#bp-year").val());
}

function get_bp_pounds() {
    return parseInt($("#bp-pounds").val());
}

function get_bp_shillings() {
    return parseInt($("#bp-shillings").val());
}

function get_bp_old_pence() {
    return parseInt($("#bp-old-pence").val());
}

function get_bp_new_pence() {
    return parseInt($("#bp-new-pence").val())/100;
}


function omtn_formula(year, pounds, shillings, old_pence, new_pence, inflation) {

    if (year <= 1970) {

        var mathResult = ((pounds + (shillings / 20) + (old_pence / 240) ) * inflation);

        return mathResult;
    }
    else if (year > 1970) {
        var mathResult = (pounds + new_pence)*inflation;

        return mathResult;
    }

}

function bp_formula(year, pounds, shillings, old_pence, new_pence, inflation){

    var bp_money_to_2005 = omtn_formula(year,pounds, shillings, old_pence, new_pence, inflation).toFixed(2);

    return {
        horses: Math.floor(bp_money_to_2005 / get_horse_price(2005)),
        cows: Math.floor(bp_money_to_2005 / get_cow_price(2005)),
        wool: Math.floor(bp_money_to_2005 / get_wool_price(2005)),
        wheat: Math.floor(bp_money_to_2005 / get_wheat_price(2005)),
        wage: Math.floor(bp_money_to_2005 / get_wage_price(2005))
    }
}



function get_inflation_rate(year) {
    return conversion_data[year].inflation;
}

function get_horse_price(year) {
    return conversion_data[year].horse_price;
}

function get_cow_price(year) {
    return conversion_data[year].cow_price;
}

function get_wool_price(year) {
    return conversion_data[year].wool_price;
}

function get_wheat_price(year) {
    return conversion_data[year].wheat_price;
}

function get_wage_price(year) {
    return conversion_data[year].wage_price;
}


